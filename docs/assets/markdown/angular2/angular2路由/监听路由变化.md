### 监听路由变化,及获取路由配置中的参数

```
import { Injectable } from '@angular/core';
import { Router, ActivatedRoute, NavigationStart, NavigationEnd, NavigationCancel, NavigationError, RoutesRecognized } from '@angular/router';
import { UpdataSubjectService } from './updata_subject.service';

@Injectable()
export class WatchRouterService {
    routerData: any = {};
    cacheAllConfig = []; // 路由配置中的所有配置
    constructor(
        public routerInfo: ActivatedRoute,
        public router: Router,
        public updataSubjectService: UpdataSubjectService,
    ) {
        // 获取所有路由配置信息
        const getRouteAllConfig = (param) => {
            if (param.children && param.children.length > 0) {
                param.children.map(x => {
                    return getRouteAllConfig(x);
                });
            } else {
                this.cacheAllConfig.push(param.data);
            }
        };
        router.config.map((x) => {
            getRouteAllConfig(x);
        });
        router.events.subscribe(event => {
            if (event instanceof NavigationStart) {
                // console.log(router);
            } else if (event instanceof NavigationEnd) { // 路由跳转结束时执行
                // console.log(router, router.url);
                const routeUrl = router.url;
                for (let i = 0; i < this.cacheAllConfig.length; i++) {
                    let routerName = routeUrl; // 定义当前路由名称
                    const curConfig = this.cacheAllConfig[i]; // 定义当前路由的配置项
                    //  跳转路由时是否包含了点，路由的静态数据项配置没有包含点，如果包含了匹配时需要去掉
                    if (routerName.indexOf('.') !== -1) {
                        routerName = routerName.split('.')[1];
                    }

                    // 跳转路由时是否包含了分号，如果包含了那么需要去掉后边的参数部分
                    if (routerName.indexOf(';') !== -1) {
                        routerName = routerName.split(';')[0];
                    }

                    if (curConfig['curRouteName'] === routerName) { // 如果当前不是空路由时
                        this.routerData = Object.assign({}, curConfig); // 获取当前自定义的路由信息
                        break;
                    } else if (routerName === '' || routerName === '/') { // 如果当前是空路由跳转到login页面时
                        this.routerData = Object.assign({}, curConfig); // 获取当前自定义的路由信息
                        break;
                    }
                }
                // 发送事件，如果路由变化了
                updataSubjectService.emitChangeRouteObservableSubject(this.routerData); // 只要是跳转路由就关闭用户反馈组件
                console.log(this.routerData);
            } else if (event instanceof NavigationCancel) {
                // console.log(router);
            } else if (event instanceof NavigationError) {
                // console.log(router);
            } else if (event instanceof RoutesRecognized) {
                // console.log(router);
            }
        });
    }
}
```